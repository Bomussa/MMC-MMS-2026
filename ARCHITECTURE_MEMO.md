# مذكرة إعادة هيكلة مشروع النظام الطبي العسكري 2026

## مقدمة
تمت إعادة هيكلة المشروع بالكامل ليصبح بنية أحادية (monorepo) منظمة، تجمع بين الواجهة الأمامية (frontend) والخلفية (backend) في مجلدات منفصلة تحت مجلد apps، مع توثيق شامل للمسارات، والاعتماديات، وأسباب التقسيم، لضمان سهولة التطوير والصيانة لأي مطور مستقبلي.

---

## الهيكلية النهائية للمشروع

```
2026/
│
├── apps/
│   ├── frontend/         # تطبيق الواجهة الأمامية (React + Vite)
│   │   ├── public/       # ملفات عامة (index.html، صور، manifest...)
│   │   ├── src/          # جميع ملفات ومجلدات كود الواجهة الأمامية
│   │   ├── package.json  # تعريف اعتمادات الواجهة الأمامية
│   │   └── ...           # إعدادات Vite و TypeScript
│   │
│   └── backend/          # تطبيق الخادم (Express + TypeScript)
│       ├── src/          # جميع ملفات ومجلدات كود الخادم
│       │   ├── api/      # نقاط النهاية (routes, middleware)
│       │   ├── core/     # منطق الأعمال والخدمات الأساسية
│       │   ├── middle/   # طبقة وسطى (adapters, engine, managers...)
│       │   ├── reports/  # تقارير النظام
│       │   ├── security/ # الحماية والتوثيق
│       │   ├── types/    # تعريفات الأنواع
│       │   ├── utils/    # أدوات مساعدة
│       │   ├── lib/      # مكتبات مشتركة
│       │   ├── infra/    # البنية التحتية (اتصال قاعدة البيانات)
│       │   ├── offline/  # دعم العمل دون اتصال
│       │   ├── components/ # مكونات خادم خاصة
│       │   ├── pages/    # صفحات API إضافية
│       │   └── theme/    # إعدادات السمات
│       ├── config/       # إعدادات وملفات التهيئة الخاصة بالخادم
│       ├── package.json  # تعريف اعتمادات الباكند
│       └── tsconfig.json # إعدادات TypeScript للباكند
│
├── tools/                # أدوات مساعدة (PowerShell, JS)
├── data/                 # بيانات النظام (settings, routes, reports...)
├── dist_server/          # ملفات البناء النهائي للخادم
├── dist_clean/           # ملفات البناء النهائي للواجهة
├── public/               # ملفات عامة جذرية (قديمة)
├── package.json          # ملف الجذر (للمونو ريبوز)
├── tsconfig.json         # إعدادات TypeScript الجذرية
├── README.md             # ملف التوثيق الرئيسي
└── ...                   # ملفات وأدلة أخرى
```

---

## شرح المسارات والملفات

### apps/frontend
- **public/**: ملفات ثابتة للواجهة (index.html, img, manifest...)
- **src/**: جميع كود React والصفحات والمكونات.
- **package.json**: اعتمادات الواجهة الأمامية فقط.
- **vite.config.js, tsconfig.json**: إعدادات البناء والتطوير.

### apps/backend
- **src/api/**: جميع نقاط النهاية (routes) وملفات middleware.
- **src/core/**: الخدمات والمنطق الأساسي (queue, routing, validation, notifications...)
- **src/middle/**: طبقة وسطى (adapters, engine, managers, guards...)
- **src/reports/**: منطق التقارير وتوليدها.
- **src/security/**: الحماية (guards, session, QR...)
- **src/types/**: تعريفات الأنواع (TypeScript types).
- **src/utils/**: أدوات مساعدة عامة (logger, time, fs-atomic...)
- **src/lib/**: مكتبات مشتركة (i18n, settings, workflow...)
- **src/infra/**: البنية التحتية (اتصال قاعدة البيانات).
- **src/offline/**: دعم العمل دون اتصال (service worker).
- **src/components/**: مكونات خادم خاصة (إن وجدت).
- **src/pages/**: صفحات API إضافية (إن وجدت).
- **src/theme/**: إعدادات السمات (إن وجدت).
- **config/**: ملفات إعدادات الخادم (features.ts ...).
- **package.json**: اعتمادات الباكند فقط.
- **tsconfig.json**: إعدادات TypeScript للباكند.

### الجذر (root)
- **tools/**: جميع أدوات الأتمتة والفحص والنسخ الاحتياطي.
- **data/**: ملفات بيانات النظام (settings, routes, reports, ...).
- **dist_server/**: ناتج بناء الخادم (backend build output).
- **dist_clean/**: ناتج بناء الواجهة (frontend build output).
- **package.json**: ملف إدارة اعتمادات المونو ريبوز (يجب أن يكون صالح JSON).
- **tsconfig.json**: إعدادات TypeScript الجذرية (للمشاركة بين المشاريع).
- **README.md**: توثيق عام للمشروع.

---

## السياسات والمعايير
- **كل ملف ومجلد له مسار ثابت وواضح**، ولا يوجد تكرار أو ازدواجية.
- **جميع الاستيرادات والتصديرات تم تحديثها** لتتوافق مع المسارات الجديدة.
- **لا يوجد أي ملف أو ثابت مفقود**، وتم التحقق من ذلك عبر البناء واختبار smoke.
- **جميع الأدلة الفرعية تم إنشاؤها مسبقًا** قبل النقل لضمان عدم فقدان أي شيء.
- **ملفات config** الخاصة بالخادم في apps/backend/config فقط.
- **ملفات البيانات الحية** في مجلد data فقط.

---

## مخطط الملفات (Tree Diagram)

يرجى الرجوع إلى المخطط أعلاه (تحت عنوان "الهيكلية النهائية للمشروع")، حيث يوضح جميع المسارات والمجلدات والملفات الرئيسية.

---

## تعليمات للمطور القادم
1. **لبناء الواجهة الأمامية:**
   ```bash
   cd apps/frontend
   npm install
   npm run build
   ```
2. **لبناء الباكند:**
   ```bash
   cd apps/backend
   npm install
   npm run build
   ```
3. **لتشغيل اختبار smoke:**
   ```bash
   cd ../../
   npm run smoke
   ```
4. **جميع المسارات محدثة ولا تحتاج لأي تعديل إضافي.**
5. **أي إضافة جديدة يجب أن تتبع نفس التقسيم والمسارات.**
6. **ملفات config والإعدادات توضع فقط في apps/backend/config.**
7. **ملفات البيانات الحية توضع فقط في data.**

---

## ملخص
- تمت إعادة الهيكلة بشكل احترافي، مع توثيق كل مسار وملف.
- لا يوجد أي نقص أو تكرار أو ازدواجية أو تعارض.
- جميع المسارات صحيحة ومثبتة.
- البناء والاختبار ناجحان.
- المشروع الآن جاهز لأي تطوير أو تسليم.

---

لأي استفسار أو تطوير لاحق، يرجى الالتزام بهذه المذكرة والهيكلية.
